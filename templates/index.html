<!DOCTYPE html>
<html>
<head>
    <title>Storytelling Chatbot</title>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="{{ url_for('static', filename='script.js') }}"></script>

</head>
<script>
    function openSettingsPopup() {
        document.getElementById('settingsPopup').style.display = 'block';
    }

    function closeSettingsPopup() {
        document.getElementById('settingsPopup').style.display = 'none';
    }
    function applySettings() {
    var bgColor = document.getElementById('bgColor').value;
    var fontSize = document.getElementById('fontSize').value + 'px';
    document.body.style.backgroundColor = bgColor;
    document.body.style.fontSize = fontSize;

    // Store selected background color in local storage
    localStorage.setItem('bgColor', bgColor);
    localStorage.setItem('fontSize', fontSize);

    closeSettingsPopup(); // Close the popup after applying settings
}
document.addEventListener("DOMContentLoaded", function() {
    // Retrieve stored background color from local storage
    var storedBgColor = localStorage.getItem('bgColor');
    if (storedBgColor) {
        document.body.style.backgroundColor = storedBgColor;
    }

    // Retrieve stored font size from local storage
    var storedFontSize = localStorage.getItem('fontSize');
    if (storedFontSize) {
        document.body.style.fontSize = storedFontSize;
    }

    // Other initialization code
});

</script>
<body>
    <div class="heading-container custom-width">
        <div class="row justify-content-between align-items-center">
            <div class="col">
                <h1 class="custom-heading">Welcome to the storytelling Chatbot</h1>
                <hr class="custom-line"> <!-- Horizontal line -->
            </div>
            <div class="col-auto">
                <button class="btn btn-secondary" onclick="openSettingsPopup()">Settings</button>
            </div>
        </div>
    </div>
    <div id="settingsPopup" class="popup-form">
        <div class="popup-content">
            <span class="close" onclick="closeSettingsPopup()">&times;</span>
            <h2>Settings</h2>
            <form>
                <label for="bgColor">Background Color:</label>
                <input type="color" id="bgColor" name="bgColor"><br><br>
                <label for="fontSize">Font Size:</label>
                <input type="range" id="fontSize" name="fontSize" min="8" max="24"><br><br>
                <button type="button" onclick="applySettings()">Apply</button>
            </form>
        </div>
    </div>

    {% if chat_history %}
    <div class="container custom-width">
        <div id="content">
            {% for item in chat_history %}
                <div class="card mb-3 {% if item.speaker == 'user' %}text-right{% endif %} {% if item.speaker == 'user' %}bg-light{% endif %}">
                    <div class="card-body">
                        {% if item.speaker == 'user' %}
                        {{ item.text }}<strong class="text-primary"> :You</strong>
                        {% elif item.speaker == 'chatbot' %}
                        <strong class="text-light-green">Chatbot: </strong>
                        <span class="text-to-speak">{{ item.text }}</span>
                        <i class="fas fa-volume-up speak-icon animate__animated animate__pulse"></i>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <form method="post" id="input-form" class="fixed-form custom-width"> <!-- Center the form -->
        <div class="row justify-content-center"> <!-- Center the input and button -->
            <div class="col-10">
                <input type="text" id="user_input" name="user_input" class="form-control " placeholder="Chat to storytelling chatbot here....">
            </div>
            <div class="col-0">
                <button type="submit" class="btn btn-primary">Send</button>
            </div>
        </div>
        {% for item in chat_history %}
            <input type="hidden" name="chat_history" value="{{ item.speaker }},{{ item.text }}">
        {% endfor %}
    </form>

    {% if error_message %}
    <div class="error-message-container custom-width">
        <div id="error-msg" class="mt-4 alert alert-danger">
            {{ error_message }}
        </div>
    </div>
    {% endif %}

    {% if quit_msg %}
    <div class="quit-msg-container custom-width">
        <div id="quit-msg" class="mt-4 alert alert-danger">
            {{ quit_msg }}
        </div>
    </div>
    {% endif %}

</body>
</html>
